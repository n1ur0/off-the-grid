# Production Environment Configuration for Off the Grid Platform
# This file contains production-specific environment variables
# SECURITY NOTE: Actual values should be stored in secure secret management

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# Environment
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO
LOG_FORMAT=json

# Application URLs
API_BASE_URL=https://api.offthegrid.io
FRONTEND_URL=https://offthegrid.io
WEBSOCKET_URL=wss://api.offthegrid.io/ws

# CORS Origins (comma-separated)
ALLOWED_ORIGINS=https://offthegrid.io,https://www.offthegrid.io

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Primary Database (PostgreSQL)
DATABASE_URL=postgresql://off_the_grid_user:${DB_PASSWORD}@postgres-primary.internal:5432/off_the_grid
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600

# Read Replica (if using)
DATABASE_READONLY_URL=postgresql://off_the_grid_reader:${DB_READONLY_PASSWORD}@postgres-replica.internal:5432/off_the_grid

# Connection SSL
DATABASE_SSL_MODE=require
DATABASE_SSL_CERT_PATH=/etc/ssl/certs/postgres-client.crt
DATABASE_SSL_KEY_PATH=/etc/ssl/private/postgres-client.key
DATABASE_SSL_CA_PATH=/etc/ssl/certs/postgres-ca.crt

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Primary Redis
REDIS_URL=redis://:${REDIS_PASSWORD}@redis-primary.internal:6379/0
REDIS_SENTINEL_HOSTS=redis-sentinel-1.internal:26379,redis-sentinel-2.internal:26379,redis-sentinel-3.internal:26379
REDIS_SENTINEL_SERVICE_NAME=mymaster

# Redis Connection Pool
REDIS_MAX_CONNECTIONS=50
REDIS_CONNECTION_POOL_SIZE=20
REDIS_RETRY_ON_TIMEOUT=true
REDIS_HEALTH_CHECK_INTERVAL=30

# Cache Configuration
CACHE_DEFAULT_TTL=3600
CACHE_KEY_PREFIX=otg_prod:

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# JWT Configuration
JWT_SECRET_KEY=${JWT_SECRET_KEY}
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Encryption Keys
ENCRYPTION_KEY=${ENCRYPTION_KEY}
FIELD_ENCRYPTION_KEY=${FIELD_ENCRYPTION_KEY}

# Session Configuration
SESSION_SECRET_KEY=${SESSION_SECRET_KEY}
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict
SESSION_COOKIE_DOMAIN=.offthegrid.io

# Security Headers
HSTS_MAX_AGE=31536000
CSP_POLICY="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.stripe.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' wss: https:; frame-src https://js.stripe.com; frame-ancestors 'none'"

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST_SIZE=20

# =============================================================================
# EXTERNAL SERVICES
# =============================================================================

# Ergo Node Configuration
ERGO_NODE_URL=https://ergo-node.offthegrid.io:9053
ERGO_NODE_API_KEY=${ERGO_NODE_API_KEY}
ERGO_EXPLORER_URL=https://api.ergoplatform.com

# Email Service (SendGrid/SES)
EMAIL_PROVIDER=sendgrid
SENDGRID_API_KEY=${SENDGRID_API_KEY}
EMAIL_FROM_ADDRESS=noreply@offthegrid.io
EMAIL_FROM_NAME="Off the Grid"

# Notification Services
SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}
DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}

# Monitoring and Observability
SENTRY_DSN=${SENTRY_DSN}
DATADOG_API_KEY=${DATADOG_API_KEY}
PROMETHEUS_METRICS_ENABLED=true
JAEGER_AGENT_HOST=jaeger-agent.internal
JAEGER_AGENT_PORT=6831

# =============================================================================
# CLOUD INFRASTRUCTURE
# =============================================================================

# AWS Configuration
AWS_REGION=us-west-2
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}

# S3 Configuration
AWS_S3_BUCKET=off-the-grid-production
AWS_S3_REGION=us-west-2
AWS_S3_CDN_URL=https://cdn.offthegrid.io

# CloudFront CDN
CDN_ENABLED=true
CDN_URL=https://cdn.offthegrid.io

# ECS Configuration
ECS_CLUSTER=off-the-grid-production
ECS_SERVICE_API=api-service
ECS_SERVICE_FRONTEND=frontend-service

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================

# API Performance
API_WORKERS=4
API_MAX_REQUEST_SIZE=10485760  # 10MB
API_REQUEST_TIMEOUT=30
API_KEEPALIVE_TIMEOUT=65

# Database Performance
DB_STATEMENT_TIMEOUT=30000  # 30 seconds
DB_QUERY_CACHE_ENABLED=true
DB_PREPARED_STATEMENTS=true

# Cache Performance
CACHE_COMPRESSION_ENABLED=true
CACHE_COMPRESSION_THRESHOLD=1024
CACHE_SERIALIZATION_FORMAT=json

# Frontend Performance
NEXT_PUBLIC_API_URL=https://api.offthegrid.io
NEXT_PUBLIC_WS_URL=wss://api.offthegrid.io/ws
NEXT_TELEMETRY_DISABLED=1

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Levels
ROOT_LOG_LEVEL=INFO
SQLALCHEMY_LOG_LEVEL=WARNING
UVICORN_LOG_LEVEL=INFO
REDIS_LOG_LEVEL=WARNING

# Log Destinations
LOG_TO_FILE=true
LOG_FILE_PATH=/var/log/off-the-grid/app.log
LOG_TO_STDOUT=true
LOG_TO_SYSLOG=false

# Structured Logging
LOG_JSON_FORMAT=true
LOG_INCLUDE_TRACE_ID=true
LOG_INCLUDE_CORRELATION_ID=true

# Log Retention
LOG_RETENTION_DAYS=30
LOG_MAX_SIZE_MB=100
LOG_BACKUP_COUNT=10

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature Toggles
FEATURE_GRID_TRADING_V2=true
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_SOCIAL_FEATURES=false
FEATURE_MOBILE_APP_API=true

# Experimental Features
EXPERIMENT_NEW_MATCHING_ALGORITHM=false
EXPERIMENT_AI_RECOMMENDATIONS=false

# Maintenance Mode
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System maintenance in progress. Please try again later."

# =============================================================================
# BUSINESS CONFIGURATION
# =============================================================================

# Trading Configuration
MAX_ACTIVE_GRIDS_PER_USER=50
MIN_GRID_SIZE_ERG=1
MAX_GRID_SIZE_ERG=1000000
DEFAULT_GRID_FEE_PERCENT=0.3

# User Limits
MAX_API_CALLS_PER_HOUR=10000
MAX_WEBSOCKET_CONNECTIONS_PER_USER=5
RATE_LIMIT_WHITELIST=${RATE_LIMIT_WHITELIST}

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_S3_BUCKET=off-the-grid-backups
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=90

# Database Backup
DB_BACKUP_ENABLED=true
DB_BACKUP_S3_PATH=database-backups/production
DB_BACKUP_ENCRYPTION_KEY=${DB_BACKUP_ENCRYPTION_KEY}

# Redis Backup
REDIS_BACKUP_ENABLED=true
REDIS_BACKUP_S3_PATH=redis-backups/production

# =============================================================================
# HEALTH CHECK CONFIGURATION
# =============================================================================

# Health Check Endpoints
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_ENDPOINT=/health
DEEP_HEALTH_CHECK_ENDPOINT=/health/deep

# Dependency Health Checks
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_EXTERNAL_APIS=true

# Health Check Timeouts
HEALTH_CHECK_DB_TIMEOUT=5
HEALTH_CHECK_REDIS_TIMEOUT=2
HEALTH_CHECK_API_TIMEOUT=10

# =============================================================================
# SECRETS MANAGEMENT
# =============================================================================
# In production, these should be loaded from AWS Secrets Manager, HashiCorp Vault, etc.

# Secret References (to be replaced by actual secrets)
DB_PASSWORD=${AWS_SECRETS_MANAGER:off-the-grid/prod/db-password}
DB_READONLY_PASSWORD=${AWS_SECRETS_MANAGER:off-the-grid/prod/db-readonly-password}
REDIS_PASSWORD=${AWS_SECRETS_MANAGER:off-the-grid/prod/redis-password}
JWT_SECRET_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/jwt-secret}
ENCRYPTION_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/encryption-key}
FIELD_ENCRYPTION_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/field-encryption-key}
SESSION_SECRET_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/session-secret}
ERGO_NODE_API_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/ergo-node-api-key}
SENDGRID_API_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/sendgrid-api-key}
SLACK_WEBHOOK_URL=${AWS_SECRETS_MANAGER:off-the-grid/prod/slack-webhook}
DISCORD_WEBHOOK_URL=${AWS_SECRETS_MANAGER:off-the-grid/prod/discord-webhook}
SENTRY_DSN=${AWS_SECRETS_MANAGER:off-the-grid/prod/sentry-dsn}
DATADOG_API_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/datadog-api-key}
DB_BACKUP_ENCRYPTION_KEY=${AWS_SECRETS_MANAGER:off-the-grid/prod/backup-encryption-key}

# =============================================================================
# CONTAINER CONFIGURATION
# =============================================================================

# Container Resources
CONTAINER_CPU_LIMIT=2
CONTAINER_MEMORY_LIMIT=4Gi
CONTAINER_CPU_REQUEST=1
CONTAINER_MEMORY_REQUEST=2Gi

# Container Health
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3
HEALTH_CHECK_START_PERIOD=60s

# =============================================================================
# SCALING CONFIGURATION
# =============================================================================

# Auto Scaling
MIN_REPLICAS=3
MAX_REPLICAS=20
TARGET_CPU_UTILIZATION=70
TARGET_MEMORY_UTILIZATION=80

# Load Balancer
LOAD_BALANCER_ALGORITHM=round_robin
LOAD_BALANCER_HEALTH_CHECK_PATH=/health
LOAD_BALANCER_HEALTH_CHECK_INTERVAL=10s

# =============================================================================
# DEVELOPMENT OVERRIDES (should be empty in production)
# =============================================================================

# These should remain empty in production
DEV_SKIP_AUTH=
DEV_MOCK_EXTERNAL_SERVICES=
DEV_DISABLE_RATE_LIMITING=